release.txt


                           MODFLOW-NWT Release Notes


This file describes changes introduced into MODFLOW-NWT with each official
release; these changes may substantially affect users. Executable files for 
personal computers are provided as well as the source code at the following URL:

http://water.usgs.gov/ogw/modflow-nwt/     

MODFLOW Files: Up-to-date descriptions of the input requirements for all 
MODFLOW-NWT Packages and Processes are provided in the Online Guide to 
MODFLOW-NWT (http://water.usgs.gov/ogw/modflow-nwt/MODFLOW-NWT-Guide/). 


NOTE: Any use of trade, product or firm names is for descriptive purposes
only and does not imply endorsement by the U.S. Government.         

o Version 1.3.0 06/01/2022:

Changed files: gwf2sfr7_NWT.f, gwf2uzf1_NWT.f, gwf2lak7_NWT.f, gwf2ag1_NWT.f, 
Irestart.f, gwf2mnw27_NWT.f, NWT1_solver.f, NWT1_module.f

Multi-Node Well (MNW2) Package
• Checks were added to the code to ensure head in the well bore (Hb) is not set 
equal to the intake altitude (HLIM) if HLIM is greater than head in the aquifer. 
This stops an extraction well from becoming a recharge well when HLIM is at a 
high elevation relative to regional groundwater levels. Similarly, for injection 
wells, a check was added to ensure Hb is not set equal to HLIM if HLIM is less 
than the head in the aquifer.


Lake (LAK) Package
• A check was added to initialize state variables for transient simulations that 
are not using restart data for initial conditions. Previously, lake stage was 
not getting set to the value specified in the LAK input file if the model was 
starting after modflow_time_zero.


Streamflow Routing (SFR2) Package
• A bug was fixed to correct the output variable for net seepage from streams 
through the UZF Package net seepage output option to account for multiple stream 
reaches within a single model cell.

Agriculture (AG) Package
• Two bugs were fixed in this package. The first bug resulted in an error in how 
the supplemental pumping was calculated for models that conjunctively use surface 
water and groundwater. The second bug fixes how results were output to the 
timeseries output files for diversions and supplemental pumping. 

Unsaturated-Zone Flow (UZF1) Package
• The groundwater ET variable was added to the formulate routine to allow groundwater 
ET to be included in the crop water consumption in the Agricultural Water Use Package.

o Version 1.2.0 03/01/2020:

Agricultural (AG) Water Use Package
• This is the first version of MODFLOW-NWT that includes this package.
Refer to Niswonger (2020) for details. Documentation for the AG Package
in included in the pdf document called AG_Package_EM&S.pdf located in
the "doc" folder. Additionally, input instructions for the AG Package are
included in the document called Input_instructions_AG.pdf located in
the "doc" folder.

Streamflow Routing (SFR2) Package
• A check was added to allow stream reaches to have altitudes below the 
cell bottom if streambed K (UHC) is zero.
• Capability was added to allow a single tabfile to specify flows into 
multiple stream reaches.

Well (WEL) package
• Character variable text was initialized in PARSEWELLOPTIONS
• A bug was fixed that was setting IUNITRAMP to default value; an 
incorrect write statement was stating that PSIRAMP was also changed; 
however, it was not changing from user-specified value. The default 
value for PSIRAMP was changed to 0.10.

Unsatuated-Zone Flow (UZF1) Package
• A new option was included for specifying the layer to which UZF 
recharge is added (NUZTOP=4). If NUZTOP is specified as 4, then 
the values of IUZFBND are used to define the top of the unsaturated 
zone, and recharge is added to the uppermost layer in a column that 
contains a water table. The layer to which recharge is added is updated 
at the beginning of each new time step and is held constant during a 
time step.
• A small bug was fixed that was causing the counter on trailing waves 
to be off by one. This bug only affected model in very rare cases; but, 
this bug could cause the model to stop suddenly.
• The calculation for total applied runoff that is output to the UZF gage 
file option 4 was incorrect. This variable only is used for gage file 
output and does not affect any other calculated values.
• A new option was added to simulate root uptake from the unsaturated zone.
This option simulates root water uptake using a capillary gradient between
a user specified root pressure and the simulated capillary pressure in the
root zone. This formulation is documented in Lappala and others (1987).

Lappala, E. G., Healy, R. W., & Weeks, E. P. (1987). Documentation of computer 
program VS2D to solve the equations of fluid flow in variably saturated porous 
media. Water-Resour. Invest. Rep, 83, 4099.

Lake (LAK) Package
• The interval for which derivatives are smoothed to zero in the calculation 
of specified outflows from lakes was changed from a constant to a variable. 
• The dead pool storage for a lake (volume of water below lowest outflow reach)
is calculated and printed to the main listing file.

Basic (BAS) Package
• The size of character variables was increased to print larger words to the 
LIST file budget table.

Link-MT3DMS (LMT) Package
• A change was made to make diversions from the last reach of a segment, rather 
than the first reach as was incorrectly assumed.
• Bug fix to prevent specification of linker file in both the name file and the 
LMT input file.  This was creating a potential for conflicting unit numbers
• Bug fix in LMT that was wrongly listing the first reach of IUPSEG as the 
'from' node when it should have been using the last reach of the IUPSEG as 
the node from which flow is diverted to the diversion segment.
• Bug fix for writing cross-sectional area to linker file for MT3D-USGS.  
Previously, when a diversion diverts all flow, the code was using the wrong 
variable for flow for calculating stream cross-sectional area.
• IUZFRCH was not properly initialized (allocated) for a steady state 
simulation.  This variable is now a part of the LMTMODULE and is allocated
in the AR routine of LMT.

Gage Package
• A minor output problem occurred when writing output for lakes when the Lake 
Package input specified RNF as a negative value, which is used as a flag, and 
OUTTYPE = 1, 3, or 4. The Gage output file incorrectly included the negative 
value rather than the actual computed value of runoff to the lake. This problem 
was corrected. The model user does not need to do anything differently. Note, 
all model calculations were correct (and not affected by the fix) and that correct 
values for runoff to a lake were always printed in the main output (listing) file.

Upstream Weighting (UPW) Package
• A warning was added indicating that IPHDRY is set to 1 (print HDRY) and
observation packages are active. IPHDRY should be set to zero because
if IPHDY is set to 1 then observation values could erroneously be
calculated using HDRY.


o Version 1.1.4 04/01/2018:

Well (WEL) package

Character variable text was initialized in PARSEWELLOPTIONS

Streamflow Routing (SFR2) Package

Subroutine CALC_XSA was added to calculate cross-sectional area for MT3D-USGS.
Smoothing of conductance in SFR used stream head and was changed to use depth.
Added error handling for case of negative flows specified in headwater segments.
Added variable IGRID to call list in subroutine SFR7AD.

Lake (LAK) Package

Error was fixed in calculation for lake volume for the linear case.

Drain Return Flow (DRT) Package

When a return cell went dry, the program failed to write
a budget record for the COMPACT BUDGET option.  This resulted in
an incorrect number of records.  Program was modified so that a
zero value is written to the budget file for a return cell if it 
is inactive.

Link-MT3DMS (LMT) Package

Changes were made to account for negative values of FLOW in SFR input.
Checks were added for DELT=0 before dividing by DELT. 

MODFLOW-NWT Main file (MF_NWT.f)

Added argument IGRID for call to SFR7AD

Gage Package

Added check to make sure SFR or LAK are active.

Upstream Weighting (UPW) Package

A warning was added indicating that IPHDRY is set to 1 (print HDRY) and
observation packages are active. IPHDRY should be set to zero because
if IPHDY is set to 1 then observation values could erroneously be 
calculated using HDRY.

Seawater Intrusion (SWI2) Package

Added FIXEDZETA option, which fixes the zeta surfaces during the simulation 
and does not allow them to move.

Multi-Node Well (MNW2) Package

These changes were made for MODFLOW-2005 version 1.12 and updated into the 
version for NWT. These changes were copied from the file "readme_MNW2.txt" 
included in the MODFLOW-2005 release.

A bug was fixed that affected the calculation of intraborehole flow (initiated 
when PUMPLOC is not = 0) for output purposes only and only for certain conditions. 
These values are written to the MNWOBS file if QBHflag>0. Additional print 
statements were also added so that data on the location of the pump intake 
will always be written to the main listing file.

The program will not calculate corrections for partial penetration of a MNW2 well
if the losstype=SPECIFYcwc, in part because the required well radius is not 
specified in the input data for this losstype. If the input for a particular MNW2 
well specifies losstype=SPECIFYcwc and PPFLAG>0, the code will reset PPFLAG to a 
value of 0, and print a related warning message.

Code was added to check if the water table drops below the bottom of the open 
interval in a MNW2 node. If it did, that node is deactivated.

Problems related to the partial penetration correction calculation have been 
reported for MNW2 nodes in convertible cells. To minimize these, the PPFLAG is 
reset to 0 if the head in the well (hwell) declines to a level that only leaves 
less than 10% of the open interval saturated or if either hwell or the water table 
drops below the bottom of the open interval (in which case the node is also 
deactivated). 

A bug in the code for the case of a horizontal or slanted well and LOSSTYPE=GENERAL 
caused the code to ignore the specified value of "B" (the linear well-loss 
coefficient) and instead assumed that it was zero. This has been fixed. Note that 
the algorithm assumes that there is no directional dependence of B and that the 
specified value applies equally in all directions. This bug would have had only 
a very small effect on results in most cases.

Write statements were modified to help assure that elevations of well screens 
(open intervals) were printed correctly. Penetration fractions values will be 
printed as "N/A" for cases where partial penetration calculations are not made.

As described on p. 53 of the MNW2 documentation report (specifically, the last 
sentence describing both "QNDflag" and "QBHflag"), additional data will not be 
written if the well contains only one node. That is, both of these flags should 
be equal to 0 if the MNW well only includes a single node. If not, code added to 
the MNWI routines will detect this inconsistency and reset these flags to zero 
and also write an information message in the main output file when this triggering 
condition is found.

Several coding changes were made based on suggestions from Scott Boyce (CA WSC) 
and are labeled with his initials (seb).

A bug was fixed for writing header information to the compact budget output file
when no wells are active.

Other minor format changes were made for the output files. 

o Version 1.1.3 08/01/2017:

Well (WEL) package
Added ability to reuse the same well tabfile for more than one well. Changed 
reading the tabfiles to allow comment lines in tabfiles. Modified output of
pumping rates to LST file to separate from printing of wells with reduced
pumping. Modified keyword input formats to support backward compatibility
of previous keyword input formats. Character variable PHIRAMP can be used
instead of SPECIFY for inputing PHIRAMP and optional output file unit number
for writing reduced pumping rates. Thus, a phiramp value and outfile file unit
number can be specified, respectively, in the first non-comment record
in the WEL input file as:

OPTIONS
phiramp 0.1 15
END

Unsaturated-Zone Flow (UZF) package
Fixed bug that occurred when IUZFOPT=0 and element 0 accessed in array DELSTOR.  
Fixed keyword options to support old format. Fixed bug in UZ initialization to 
allow multiple consecutive steady state stress periods. Fixed bug causing UZF 
land surface to be incorrectly set for cells underlying lake cells. 

Streamflow Routing (SFR2) Package
Keyword options were modified to allow for backward compatibility of previous input
formats of keywords, including single line lists of keywords and keywords not
surrounded by OPTIONS and END identifiers. A bug was fixed that affects models
that use the LOSSFACTOR option for reducing streambed hydraulic conductivity for
losing streams. This bug fix significantly affected stream seepage loss for models
that specified a lossfactor value less than 1.

Lake (LAK) Package
Fixed array index from DELVOLLAK(NSSAR) to DELVOLLAK(NLAKES). Fixed lake package 
derivatives for better solutions. Fixed instability issue with Lake Package for 
small lakes and large surface inflow and outflow.

Multi-Node Well (MNW2) Package
Initialized variable Hwell. Fixed reference to lbotm in botm arrays used for models  
with quasi-confining units.

Link-MT3DMS (LMT) Package
Terms appearing in either SFR or LAK were removed from the LMTMODULE and instead 
placed in SFRMODULE or LAKMODULE. Added IGWET to the LMTMODULE and allocated the 
variable to avoid memory overwrite errors. Bug fix for binary output in LMT (an 
extra term was being written that was causing problems to the FMI package in 
MT3D-USGS). Fixed a bug in LMT related to the linkage of groundwater discharge 
(or runoff) to a sink (that is, not connected to surface-water through IRUNBND). 
Bug fix to LMT to use KPER and KSTP from PRMSMODULE instead of GSFMODFLOW

MODFLOW-NWT Main file (MF_NWT.f)
Changed code to write a warning if model fails to converge and NWT solver
character variable CONTINUE is specified. The phrase "Normal termination
of simulation" is no longer printed to the screen or LST file if the model 
fails to converge.
 
o Version 1.1.2 09/15/2016:

MODFLOW-NWT version 1.1.2 is based on MODFLOW-2005 version 1.11.0.

Unsaturated-Zone Flow (UZF) Package

A floating point exception was fixed.

WELL (WEL) Package

A bug was fixed that would cause the pumping rate to be calculated incorrectly
when using the tabfile option and the time values specified in the tabfile
did not extend to the end time of the simulation.

Multi-Node Well (MNW2) Package

A floating point exception was fixed.

Streamflow Routing (SFR2) Package

An access violation was fixed. 

o Version 1.1.1 07/28/2016:

MODFLOW-NWT version 1.1.1 is based on MODFLOW-2005 version 1.11.0.

Unsaturated-Zone Flow (UZF) Package

A bug was fixed to initialize a variable. This bug could affect convergence
for problems that simulate linear groundwater ET in the UZF Package when
using the NWT solver. 

o Version 1.1.0 07/21/2016:

MODFLOW-NWT version 1.1.0 is based on MODFLOW-2005 version 1.11.0. This 
means that MODFLOW-2005 source files used in MODFLOW-NWT were updated to
reflect changes made for MODFLOW-2005 version 1.11.0. Refer to release 
notes for MODFLOW-2005 version 1.11.0 for these changes.

This release provides support for the new transport model called MT3D-USGS. 
Changes to MODFLOW-NWT to support MT3D-USGS were made to the source file 
lmt8_NWT.f. These changes include writing output for the UZF, SFR2, and 
LAK7 packages that is required for simulating transport in the unsaturated 
zone, streams, and lakes. Refer to the MT3D-USGS documentation report 
(Bedekar and others, 2016) for details. Refer to the LMT release notes file
"LMT8.pdf" located in ..\MODFLOW-NWT_1.1.0\doc

Upstream Weighting (UPW) Package

An error was fixed in the calculation of the derivative for smoothing conductance  
during complete wetting of a cell. Testing using several problems indicated that 
this change has minimal effects on the solution.

NWT solver (NWT) Package

Previous versions of MODFLOW-NWT reported a warning when the difference between
a specified cell top and cell bottom was less than 100*Thickfact, where Thickfact 
is an input variable specified within the NWT solver input file. These cells were 
set to inactive by setting IBOUND=0. This conditions is now treated as an error
and the model will stop if TOP-BOT<100*Thickfact.

An error was fixed in the calculation of the derivative for smoothing conductance  
during complete wetting of a cell. Testing using several problems indicated that 
this change has minimal effects on the solution.

A minor memory allocation error was fixed in GMRES that affected compilations using 
the gfortran compiler

Default solver input values for the xmd solver (Linmeth=2) were modified to improve 
convergence. Solver input values for the SIMPLE, MODERATE, and COMPLEX default options
are:

Simple:
        DBDTHETA     = 0.97
        DBDKAPPA     = 0.0001
        DBDGAMMA     = 0.0
        MOMFACT      = 0.0
        BACKFLAG     = 0
        MAXBACKITER  = 20
        BACKTOL      = 1.5
        BACKREDUCE   = 0.97
        IACL         = 1
        NORDER       = 0
        LEVEL        = 1
        NORTH        = 5
        IREDSYS      = 1
        RRCTOLS      = 0.0
        IDROPTOL     = 1
        EPSRNS       = 5.0e-3
        HCLOSEXMD    = 1.0e-3
        MXITERXMD    = 50
Moderate:
        DBDTHETA     = 0.90
        DBDKAPPA     = 0.00001
        DBDGAMMA     = 0.0
        MOMFACT      = 0.1
        BACKFLAG     = 0
        MAXBACKITER  = 20
        BACKTOL      = 1.1
        BACKREDUCE   = 0.9
        IACL         = 1         
        NORDER       = 0                
        LEVEL        = 1        
        NORTH        = 10     
        IREDSYS      = 1
        RRCTOLS      = 0.0
        IDROPTOL     = 1
        EPSRNS       = 5.0e-3  
        HCLOSEXMD    = 1.0e-3  
        MXITERXMD    = 100      
Complex:
        DBDTHETA     = 0.85
        DBDKAPPA     = 0.00001
        DBDGAMMA     = 0.0
        MOMFACT      = 0.1
        BACKFLAG     = 1
        MAXBACKITER  = 50
        BACKTOL      = 1.1
        BACKREDUCE   = 0.7
        IACL         = 2
        NORDER       = 0
        LEVEL        = 15
        NORTH        = 1
        IREDSYS      = 1
        RRCTOLS      = 0.0
        IDROPTOL     = 1
        EPSRNS       = 1.0e-3
        HCLOSEXMD    = 1.0e-4
        MXITERXMD    = 200

Streamflow Routing (SFR2) Package

The input format for specifying character variable options has changed. Rather than
specifying character variable options in a single line in a particular order, 
each character variable option is specified on a separate line. If additional input 
is required along with the character variable option then this value is specified on 
the same line as the character variable option separated by one or more spaces. Options 
must be proceeded with the "OPTIONS" specification and followed by the "END"  
specification. Characters can be specified as upper or lower case.

Optional character variables for SFR2 in any order:

[OPTIONS]
[REACHINPUT]
[TRANSROUTE]
[TABFILES Numtab Maxval]
[LOSSFACTOR Factor]
[END]

Definitions for new character variable option:

LOSSFACTOR -- An optional character variable. When LOSSFACTOR is specified, the 
              real variable Factor is multiplied by STRHC1 or Hc1fact and Hc2fact 
              to calculate seepage loss from streams. Calculation of groundwater 
              seepage to streams is unchanged.

Some variables in the SFR2 Package were initialized. Some variables were changed
to arrays for use in MT3D-USGS.

Unsaturated-Zone Flow (UZF) Package

Note that the following changes to the UZF options will no longer support previous
versions of UZF input files that used key word options. Previous UZF1 input 
files must be modified to be consistent with the new character variable input
options described below.

Some variables in the UZF Package for calculating runoff were initialized.
A minor bug was fixed that relates to simulating unsaturated-zone flow 
beneath lakes.

New Options were added to UZF1 to allow the hydraulic conductivity used to
calculate rejected infiltration and surface leakage to be different than
the vertical hydraulic conductivity of the unsaturated zone (VKS). 

A new function was added for simulating groundwater ET. This function simulates
a constant ET rate over the extinction depth rather than linearly reducing 
ET as groundwater head decreases. The ET is smoothly reduced to zero using the 
same polynomial function used to reduce pumping in drying cells (Niswonger 
and others, 2011). ET is smoothly reduced as groundwater head drops to the  
extinction depth. The smoothing interval is specified as a factor of the extinction  
depth.

The input format for specifying character variable options has changed. Rather than
specifying character variable options in a single line in a particular order, 
each character variable option is specified on a separate line. If additional input 
is required along with the character variable option then this value is specified on 
the same line as the character variable option separated by one or more spaces. 
Options must be proceeded with the "OPTIONS" specification and followed by the "END"  
specification. Letters can be specified as upper or lower case.

Optional character variables for UZF1 in any order:

OPTIONS
[SPECIFYTHTR] 
[SPECIFYTHTI] 
[NOSURFLEAK] 
[SPECIFYSURFK] 
[REJECTSURFK] 
[SEEPSURFK] 
[ETSQUARE smoothfact]
[NETFLUX unitrech unitdis]  
END 

Definitions of new variables:

SPECIFYSURFK -- An optional character variable. When SPECIFYSURFK is specified, the 
                variable SURFK is specified in Data Set 4b.

REJECTSURFK -- An optional character variable. When REJECTSURFK is specified, SURFK 
               instead of VKS is used for calculating rejected infiltration. 
               REJECTSURFK only is included if SPECIFYSURFK is included.
              
SEEPSURFK -- An optional character variable. When SEEPSURFK is specified, SURFK 
             instead of VKS is used for calculating surface leakage. SEEPSURFK 
             only is included if SPECIFYSURFK is included.

ETSQUARE -- An optional character variable. When ETSQUARE is specified, 
            groundwater ET is simulated using a constant potential ET
            rate, and is smoothed over a specified smoothing interval. This
            option is recommended only when using the NWT solver.

smoothfact --  An optional real variable specified if ETSQAURE is specified. For 
               example, if the interval factor (smoothfact) is specified as 
               smoothfact=0.1 (recommended), then the smoothing interval will be
               calculated as: SMOOTHINT = 0.1*EXTDP and is applied over the 
               range for groundwater head (h): 

               h < CELTOP-EXTDP, ET is zero;
               CELTOP-EXTDP < h < CELTOP-EXTDP+SMOOTHINT, ET is smoothed;
               CELTOP-EXTDP+SMOOTHINT < h, ET is equal to potential ET.
               
NETFLUX -- An optional character variable. When NETFLUX is specified, the sum 
           of recharge (L3/T) and the sum of discharge (L3/T) is written to separate 
           unformatted files using module UBDSV3. Unitrech and Unitdis are the unit   
           numbers to which these values are written when “SAVE BUDGET” is specified 
           in Output Control. Values written to Unitrech are the sum of recharge  
           values for the UZF, SFR2, and LAK packages, and values written 
           to Unitdis are the sum of discharge values for the UZF, SFR2, and 
           LAK packages. Values are averaged over the period between output times.


DATA SET 4b:

[SURFK (NCOL, NROW)] -- U2DREL

SURFK -- An optional array of positive real values used to define the hydraulic 
         conductivity (LT-1). SURFK is used for calculating the rejected infiltration  
         and/or surface leakage. IF SURFK is set greater than VKS then it is
         set equal to VKS.

A new test problem is included in \MODFLOW-NWT_1.1.0\data called UZFtestoptions
that provides example input for these new options.

Lake (LAK) Package

Some variables were changed to arrays in order to save data for MT3D-USGS.
A minor bug was fixed that relates to simulating unsaturated-zone flow 
beneath lakes.

WELL (WEL) Package

Note that the following changes to the Well Package input no longer supports
previous input files that read the key word option SPECIFY in Data Set 2B.
 
The input format for specifying the keyword (character) variable SPECIFY has changed.
This character variable is now specified within the OPTIONS block that is specified 
between Data Set 0 and Data Set 1. A new character variable option was added
that allows users to specify pumping rates using separate tabular input files 
for each well. Each tabular input file consists of a series of simulation
times and pumping rates that should begin with time equal to zero. The applied pumping 
rate will be interpolated from the tabular input file using the times at the end and 
beginning of the time step. Options must be proceeded with the "OPTIONS" specification   
and followed by the "END" specification. Characters can be specified as upper or lower case.

Optional character variables for WELL in any order:

OPTIONS
[SPECIFY PHIRAMP IUNITRAMP]
[TABFILES NUMTAB MAXVAL]
END

Definitions for new character variable option:

TABFILES -- An optional character variable. When TABFILES is specified, all pumping
rates for all wells in the model will be input using separate time series tabular
input files. 

NUMTAB -- An integer variable that is the number of tabular input files that
will be read for interpolating pumping rates for each well in the model. A 
separate tabular input file is required for each well in the model. Wells
can be made inactive by specifying pumping rates of zero for times when a well
is inactive.

MAXVAL -- An integer value equal to the maximum number of time series
values specified in the tabular input file, not including header lines. 
Tabular input files each can have a different number of values and MAXVAL
is the number of lines in the tabular input file that has the most lines
as compared to all other tabular input files.

IF TABFILES is specified then DATA SET 6 is replaced with the following NUMTAB
lines for stress period 1 only. DATA SET 6 is not required for stress periods
following the first stress period when the TABFILES option is used.

[TABUNIT TABVAL TABLAY TABROW TABCOL]   #repeat this line NUMTAB times for stress period 1. 

TABUNIT -- An integer value equal to the unit number for the tabular input file.
This unit number must match the unit number specified in the MODFLOW Name file
as type data.

TABVAL -- An integer value equal to the number of lines in this tabular input file 
not including header lines.

TABLAY -- An integer value equal to the MODFLOW layer for the cell to which the 
pumping rates will be applied.

TABROW -- An integer value equal to the MODFLOW row for the cell to which the 
pumping rates will be applied.

TABCOL -- An integer value equal to the MODFLOW column for the cell to which the 
pumping rates will be applied.

A new test problem was added to the directory .\MODFLOW-NWT_1.1.0\data
that includes example input files for using the tabular input file option
for specifying pumping. 

A bug was fixed that sets pumping applied to inactive cells to zero. This bug
only affects results printed to the cell by cell budget file. A small error was
fixed in the calculation of the derivative used for smoothing the pumping rate
to zero for drying cells.

Multi-Node Well (MNW2) Package

A bug was fixed to correct budget calculations when the UPW Package was
used with MNW2. The model stopped and an error was reported when a well 
was screened in multiple cells and one of the cells was inactive. This error
was changed to be a warning if one of the screened cells is active and
execution continues.

Surface Water Routing (SWR) Process

The names of the source files were changed from gwf2swr7_NWT.f to gwf2swr7.f
and gsol7.f to gwf2swr7util.f. See SWRProcess_release.txt for a summary of
the changes made to SWR Process v 1.04.


Source files that were modified for this release are: gwf2uzf1_NWT.f,gwfuzfmodule_NWT.f,
gwf2sfr7_NWT.f,gwfsfrmodule_NWT.f,gwf2lak7_NWT.f, NWT1_gmres.f90, gwf2swr7.f,
gwf2swr7util.f, gwf2mnw27_NWT.f, gmres.f90, NWT1_solver.f and NWT1_xmd.f, and
lmt8_NWT.f.


o Version 1.0.9 07/01/2014:

Basic (BAS) package

Fixed output file control for parallel writing of output to files.

Well (WEL) package

Initialization of a variable was added as it was not previously getting initialized 
correctly. Fixed minor error in smoothing function derivative.

Unsaturated-Zone Flow (UZF) package

A bug was fixed to correct the applied infiltration rate as printed to the UZF1 gage
output file summed over the entire model. Previous versions did not include applied 
infiltration rates in excess of VKS. This bug did not affect calculations or 
solutions made by UZF, rather only the values for applied infiltration written
to UZF1 gage output summed over the entire model were affected.

Lake (LAK) Package

Fixed compact budget for outputting lake seepage. A small change was made that sets  
layer indices for calculating lakebed conductance.

Multi-Node Well (MNW2) Package

A bug was fixed that was causing the cell to well transmissivity to incorrectly be
set to zero.

Link-MT3DMS (LMT) Package

Some changes were made to output model results to be compatible with MT3DMS for simulations
that include UZF1.

o Version 1.0.8 09/24/2013:

A significant change to MODFLOW-NWT for this release was the addition of the Seawater 
Intrusion (SWI2) Package for MODFLOW (Bakker and others, 2013). Refer to the SWI2 
documentation report available at http://pubs.usgs.gov/tm/6a46/ for details regarding
the functionality and input required for SWI2. Modifications to MODFLOW-NWT that were 
made to support SWI2 include the addition of one new source code file (gwf2swi27_NWT.f) 
and the addition of call statements added to the MODFLOW-NWT main source code file
(MF_NWT.f).

Lake (LAK) Package

A bug was fixed to correctly print lake seepage to unformatted budget files. This 
bug affects models with lake cells that are surrounded by inactive groundwater cells
in the same lake.

Small changes were made to the following source code files to remove specification of 
machine constants for single precision variables: mach_mod.f, modules.f, NWT1_gmres.f, 
NWT1_ilupc_mod.f, and NWT1_module.f

Streamflow Routing (SFR2) Package

A bug was fixed to avoid a memory-allocation error that occurred when using
the tabfile option for models with more tabfiles than stream segments. Also,
an uninitialized variable was initialized.

Subsidence (SUB) Package

Support was added for the Subsidence Package using the NWT solver and Upstream-Weighting
Flow Package. Changes to the code consist of setting storage changes related to subsidence 
to zero when head falls below the cell bottom.

Unsaturated-Zone Flow (UZF1) Package

A bug was fixed to allow the vertical hydraulic conductivity to be read when 
IUZFOPT=-1; that is, when unsaturated-zone storage is ignored and infiltrated water
is added directly to the water table. 

The maximum root depth was reduced from extending through 99% of the cell thickness
to 90% of the cell thickness. This improves convergence for models where the root
depth extends to the bottom of the cell.

Initialization was added for a few variables and checks were added for divide by zero.

Surface-Water Routing (SWR1) Process

Additional functionality was added to the SWR1 Process incorporated in 
MODFLOW-NWT. The modifications to the SWR1 Process (version 1.03) are documented in the 
document titled 'SWRProcess_release.txt' included with this distribution. Complete SWR 
input instructions for version 1.03 are provided in:
'..\MODFLOW-NWT_1.0.8\doc\SWRProcessInputInstructions_v1.03.pdf' included with this 
distribution.

SWR test problems 1-4 have been removed from the distribution but are still available
at http://water.usgs.gov/ogw/swr/. SWR test problems 1-4 are surface-water only problems
and do not use the functionality of MODFLOW-NWT. SWR test problem 5 is a coupled
surface-water/groundwater problem that does use the functionality of MODFLOW-NWT.

MODFLOW-NWT Main file

At the onset of each time step, groundwater heads were set to their values one iteration
prior to convergence after each times step. This change has no effect on the solution but
was made for consistancy with the standard Newton solution approach. 

Link-MT3DMS (LMT) Package

A bug was fixed to print the fluxes coming out of the bottom of dry cells. This change
will have a significant effect on transport solutions for groundwater flow problems
that contain dry cells with fluxes moving through them.

Source files that were modified for this release include:

gwf2lak7_NWT.f, gwf2sfr7_NWT.f, gwf2sub7_NWT.f, gwf2uzf1_NWT.f, MF_NWT.f, lmt7_NWT.f,
gwf2swi27_NWT.f, gwf2swr7_NWT.f, gsol7.f

o Version 1.0.7 01/15/2013:

Lake (LAK) Package

In versions of MODFLOW-NWT prior to 1.0.6, when the Lake Package was used simultaneously 
with the HUF Package, the effective (combined) aquifer-lakebed conductances were 
not calculated correctly.  In this update, the Lake Package has been modified to 
compute effective lake-aquifer conductance solely on the basis of the user-specified 
value of lakebed leakance; aquifer hydraulic conductivities are not used in this 
calculation.  An appropriate informational message is now printed after the lakebed 
conductances are written to the main output file.  There have also been several minor 
changes to format statements to improve the information content of the output file. 

Multi-Node Well (MNW2) Package

An argument mismatch was corrected between the call to the subroutine GWF2MNW27RP
from MF_NWT.f to gwf2mnw27_NWT.f. 

A bug was fixed that affected simulations in which a composite well screen was 
generated when specifying multiple open intervals by elevation. In this case, 
some nodes were inadvertently excluded from the second interval. With the fix, 
all nodes of the multi-node well will be represented. Some output format 
adjustments were also made.

If a single-node multi-node well with a nonzero specified discharge was located 
in an inactive cell (IBOUND=0), it could generate a divide-by-zero error and 
halt execution of the program. The code was fixed to preclude such a 
floating-point error from occurring. A new warning message is now also written to 
the output file if this condition is detected.

If the well yield (and pumping rate) was reduced because of the seepage face 
calculations, an incorrect message (indicating erroneously that the cause was the 
head constraint) was written to the output file. The code was fixed so that 
possible causes of reduced pumping rates are accurately printed.

The code was modified to eliminate separate processing for single-node MNW2 wells, 
which eliminated some inconsistencies in handling single-node wells. If the computed 
value for the head in single-node wells drops below the bottom of the cell, it invokes 
the seepage face calculation, which will reduce or eliminate the desired Q from the 
well. In cases where the Qdes is thereby reduced, the actual head in the well is 
indeterminate, but will be reported in separate MNWI output files as the limiting 
value of the bottom elevation of the cell together with an information note that the 
actual value may be lower than that reported value.  If Qdes is reduced to zero, the 
well is deactivated and that information is reported in the MNWI optional MNW2 
observation well file. 
 
At the end of the first paragraph on p. 32 of the documentation report, it states that 
the alternate calculations for CWC for nonvertical wells will be performed automatically 
when LOSSTYPE = THIEM, SKIN, or GENERAL. Unfortunately, the code did not check this 
condition, and erroneously performed these calculations when LOSSTYPE = SPECIFYCWC.  
The corrected code now uses the specified values of CWC for nonvertical wells when it 
is supposed to.

The code automatically estimates the maximum number of nodes (NODTOT) as required for 
allocation of arrays. However, if a large number of horizontal wells are being simulated, 
or possibly for other reasons, this default estimate proves to be inadequate, a new 
input option has been added to allow the user to directly specify a value for NODTOT. If 
this is a desired option, then it can be implemented by specifying a negative value for 
"MNWMAX"--the first value listed in Record 1 (Line 1) of the MNW2 input data file. If 
this is done, then the code will assume that the very next value on that line will be 
the desired value of "NODTOT". The model will then reset "MNWMAX" to its absolute value. 
The value of "IWL2CB" will become the third value on that line, etc.

The code included several coding errors in the calculation of cell-to-well conductances 
for nonvertical wells. There was also an error in the calculation of the length of closed 
casing between sequential, but non-adjacent, active nodes of a nonvertical MNW2 well (a 
value only used for informational purposes in the output file).  All of these errors have 
now been fixed. 

A bug was fixed that affected simulations when both MNW2 and the HUF Packages 
were used in the same simulation in conjunction with the partial penetration
correction. The variable KY is now declared as a Double Precision variable 
instead of being implicitly assumed (incorrectly) to be an Integer variable.  

A number of minor changes were made in Format statements to produce a cleaner 
output file.

In Subroutines GWF2MNW27BCF and GWF2MNW27HUF, corrections were made to assure 
the correct check is made for steady-state or transient conditions and to prevent 
a divide by zero error if a cell is dry. 

A bug was fixed for the calculation of angles theta and omega for slanted wells 
with an orientation into the southwest directional quadrant.

A bug was fixed that caused erroneous values to be written to the compact budget 
file (specifically, for inactive MNW wells), although the numerical solution itself 
was accurate, as were the budget numbers written to the main listing file.  

Hydrogeologic-Unit Flow (HUF) Package

Small changes were made to make RHS and HCOF double precision when passed as
subroutine arguments.

Preconditioned Conjugate Gradient (PCG) Package

Small changes were made to make RHS and HCOF double precision when passed as
subroutine arguments.

NWT Main File (MF_NWT.f)

The version number and date were made consistent with MODFLOW-2005 1.9.01, 05/01/2012

Streamflow Routing (SFR2) Package

An uninitialized variable was initialized.

Gage Package

Commas were added to some write statements.

Modified source files: gwf2mnw27_NWT.f, MF_NWT.f, gwf2lak7_NWT.f, gwf2mnw2i7.f,
nogmg.f, gwf2huf7.f, pcg7_NWT.f, gwf2sfr7_NWT.f, gwf2gag7.f

o Version 1.0.6 12/05/2012:

The most significant change to MODFLOW-NWT for this release was the addition of the Surface-
Water Routing Process (Hughes and others, 2012). Refer to the SWR1 documentation report 
located in MODFLOW-NWT_1.0.6\doc for details regarding the functionality
and input required for SWR1. Modifications to MODFLOW-NWT that were made to support SWR1
include the addition of two new source code files (gsol7.f and gwf2swr7_NWT.f) and the
addition of call statements added to the MODFLOW-NWT main source code file (MF_NWT.f). Additionally,
there are 5 test problems that use SWR1 included with this release for testing the linkage
between MODFLOW-NWT and SWR1 located in MODFLOW-NWT_1.0.6\data\SWR_data_files. Refer
to the readme files for more details on these test problems and other aspects of SWR1.

Newton Solver

Changes were made to default input values when the key word options are used. These
changes reflect information gained from testing using numerous groundwater models 
The defaults values for "SIMPLE," "MODERATE," and "COMPLEX" are now as follows:

"SIMPLE"
IACL = 1, NORDER = 0, LEVEL = 3, NORTH = 5, IREDSYS = 1, All other values remain the same.

"MODERATE"
DBDTHETA = 0.9, NORDER = 0, LEVEL = 5, NORTH = 5, IREDSYS = 1, RRCTOLS = 0.0, IDROPTOL = 1,
EPSRN = 1.0e-4, HCLOSEXMD = 1.0e-4, MXITERXMD = 50, All other values remain the same.

"COMPLEX"
DBDTHETA = 0.85, BACKFLAG=1, MAXBACKITER=50, BACKTOL=1.1, BACKREDUCE=0.7,
LEVEL = 5, IREDSYS = 1,EPSRN = 1.0e-5, HCLOSEXMD = 1.0e-5, MXITERXMD = 100, 
All other values remain the same.

Lake (LAK) Package

Moved the read statements for specified lake bathymetry to proceed the stress period information.
This change does not affect results or input instructions. Refer to the updated input 
instructions for using external lake bathymetry input files titled  "Lake3_Input_Modified.pdf" 
located in \MODFLOW-NWT_1.0.6\doc for details. A new test problem was added to the MODFLOW-NWT
release 1.0.6 that demonstrates the use of external bathymetry input files. This problem can
be run by executing the batch file 'l1b2k_bath.bat' located in MODFLOW-NWT_1.0.6\data. Input 
for this test problem is located in MODFLOW-NWT_1.0.6\data\Lake_bath_example and output is included
in MODFLOW-NWT_1.0.6\output_test. This test problem is identical to the MODFLOW-2005 test problem
l1b2k documented in Merritt and Konikow (2000) as test problem 1, except for the use of external  
bathymetry input files. Thus, the results are unchanged relative to the original results produced 
by MODFLOW-2005. Also, a bug was found that affects simulations that use the Hydrologic-Unit Flow 
(HUF) Package (Anderman and Hill, 2000). Due to the difficulty in determining the effective 
vertical hydraulic conductivity in the HUF Package, the option to use the HUF Package with
the Lake package has been removed from MODFLOW-NWT. Thus, an error will be printed and the 
program will stop if the HUF and LAK Packages are used together in a simulation.

WELL (WEL) Package

A bug was fixed to allow the reduced pumping information to be written correctly to the LIST file
or separate text file.

xMD Matrix Solver

Some initialization issues associated with Bi-cgstab and Orthomin were resolved, and some 
minor changes were made.

Basic (BAS) package

The variables RHS and HCOF were made double precision.

Upstream Weighting (UPW) Package 

Some variables were made double precision and the precision used in calculations
was made consistent. Added an option to turn off the checking that a value is 
defined for all cells when parameters are used to define layer data. This option 
is implemented by specifying the keyword "NOPARCHECK" as one of the options in
input Item 1 of the UPW input file.

Streamflow Routing (SFR2) Package

Some variables were made double precision and the precision used in calculations
was made consistent. Some minor calculations were modified for solution efficiency.
Allocation of some variables were changed to reduce the amount of random access memory (RAM)
required for simulations. These changes did not affect simulation results. Initialization
of some local variables was added.

Unsaturated-Zone Flow (UZF1) Package

Initialization of some local variables was added.

Multi-Node Well (MNW2) Package

Checks were added for calculations that divide real numbers. Changes were made to be 
consistent with version released with MODFLOW-2005 v1.9.

General-Head Bounday (GHB) Package

Changes were made to be consistent with version release with MODFLOW-2005 v1.9.

Strongly Implicit Procedure (PCG) Package

The variables RHS and HCOF were made double precision.

Preconditioned Conjugate-Gradient (PCG) Package

The variables RHS and HCOF were made double precision.

Direct Solver (DE) Package

The variables RHS and HCOF were made double precision.

The Stream Observation Package (obs2str7.f) was added.

o Version 1.0.5 05/14/2012:

Newton Solver

Changes were made to fix a bug that caused Hdry to be printed for confined cells that
have heads below the cell bottom altitude. Hdry only will be printed for unconfined
layers.

Changes were made to default input values when the key word options are used. These
changes reflect information gained from testing using numerous groundwater models 
The defaults values for "SIMPLE," "MODERATE," and "COMPLEX" are now as follows:

"SIMPLE"
IACL = 1, NORDER = 0, LEVEL = 3, NORTH = 5, IREDSYS = 1, RRCTOLS = 0.0, IDROPTOL = 1
EPSRNS = 1.0e-3, HCLOSEXMDDUM = 1.0e-4, MXITERXMD = 50, All other values remain the same.

"MODERATE"
IACL = 2, NORDER = 1, LEVEL = 5, NORTH = 5, IREDSYS = 1, RRCTOLS = 0.0, IDROPTOL = 1
EPSRNS = 1.0e-3, HCLOSEXMDDUM = 1.0e-4, MXITERXMD = 50, All other values remain the same.

"COMPLEX"
IACL = 2, NORDER = 1, LEVEL = 5, NORTH = 7, IREDSYS = 1, RRCTOLS = 0.0, IDROPTOL = 1
EPSRNS = 1.0e-5, HCLOSEXMDDUM = 1.0e-5, MXITERXMD = 50, All other values remain the same.

xMD Matrix Solver

Some initialization issues associated with Bi-cgstab and Orthomin were resolved, and some 
minor changes were made.


Well Package

Changes were made to report wells with reduced pumping due to dewatered conditions
to a separate output file or to the main listing file. If the wells with reduced pumping 
rates are written to a separate output file then a file of type "DATA" must be included
in the Name file with a unit number that matches the unit number specified in the 
Well file (following the variable PHIRAMP in Item 2b). For example, a value of
PHIRAMP (see MODFLOW-NWT documentation report) of 0.3 and a unit number of 50 can be 
specified in the second line of the Well file using the key word "SPECIFY" as:

SPECIFY  0.3  50

The following line must be added to the Name file:

DATA     50    Reduced_wells.out

Thus, wells with reduced pumping will be written for each time step to the output file
"Reduced_wells.out" with unit number 50. For example, wells with reduced pumping will
be reported to file "reduced_wells.out" as:

 WELLS WITH REDUCED PUMPING FOR STRESS PERIOD     6 TIME STEP     2
   LAY   ROW   COL         APPL.Q          ACT.Q        GW-HEAD       CELL-BOT
     4    91    69  -0.104400E+04  -0.104399E+04   0.208142E+04   0.205380E+04
     4    91    69  -0.208800E+04  -0.208798E+04   0.208142E+04   0.205380E+04
     4    91    69  -0.208800E+04  -0.208798E+04   0.208142E+04   0.205380E+04
 
 
 WELLS WITH REDUCED PUMPING FOR STRESS PERIOD     6 TIME STEP     3
   LAY   ROW   COL         APPL.Q          ACT.Q        GW-HEAD       CELL-BOT
     4    91    69  -0.104400E+04  -0.967118E+03   0.207686E+04   0.205380E+04
     4    91    69  -0.208800E+04  -0.193424E+04   0.207686E+04   0.205380E+04
     4    91    69  -0.208800E+04  -0.193424E+04   0.207686E+04   0.205380E+04

Streamflow-Routing Package

A small bug was fixed that stopped the stream width from being set equal to the  
wetted perimeter for ICALC=2. This change only affects the printout of stream
width, and calculations dependent on stream width were made using the correct
value in previous versions of SFR2. 

Changes were made to printout all stream reaches with streambed altitudes below
the cell bottom before the model stops due to this error. Previous versions
of the code printed out the first reach encountered with an altitude error 
and stopped. This version prints information for all reaches with altitude 
errors to the List file before stopping the simulation. An example of this
error printout extracted from the List file is shown below.

  REACHES WITH ALTITUDE ERRORS:
    LAY    ROW    COL    SEG  REACH      STR.ELEV.      CELL-BOT.
      1      4     57      1     57     -1.7500000      0.0000000
      1      4     58      1     58     -4.2500000      0.0000000
      1      4     59      1     59     -6.7500000      0.0000000
      1      4     60      1     60     -9.2500000      0.0000000
      1      4     61      1     61    -11.7500000      0.0000000
      1      4     62      1     62    -14.2500000      0.0000000
      1      4     63      1     63    -16.7500000      0.0000000
      1      4     64      1     64    -19.2500000      0.0000000
      1      4     65      1     65    -21.7500000      0.0000000
 MODEL STOPPING DUE TO REACH ALTITUDE ERROR


Multi-Node Well Package version 2 (MNW2)

Changes were made to the MNW2 Package by the authors of the package 
(Konikow and others, 2009) for version 1.9 of MODFLOW-2005. These changes also
were made to this release of MODFLOW-NWT. These changes are:

A bug was fixed that affected simulations when both MNW2 and the HUF Package 
were used in the same simulation in conjunction with the partial penetration
correction. The variable KY is now declared as a Double Precision variable 
instead of being implicitly assumed (incorrectly) to be an Integer variable.  

A number of minor changes were made in Format statements to produce a cleaner 
output file.

In Subroutines GWF2MNW27BCF and GWF2MNW27HUF, corrections were made to assure 
the correct check is made for steady-state or transient conditions and to prevent 
a divide by zero error if a cell is dry. 

A bug was fixed for the calculation of angles theta and omega for slanted wells 
with an orientation into the southwest directional quadrant.

A bug was fixed that caused erroneous values to be written to the compact budget 
file (specifically, for inactive MNW wells), although the numerical solution itself 
was accurate, as were the budget numbers written to the main listing file.  

Additional changes were made to the MNW2 Package for MODFLOW-NWT. These changes do not  
affect simulations using the MNW2 Package with solvers other than the NWT solver within 
MODFLOW-NWT. These changes were required to solve instabilities created by seepage face 
conditions within a MNW2 well and when a cell containing a MNW2 well becomes dry. The first 
change resets the head in a well to the bottom of the cell when it falls below the bottom 
of the cell for each node. For certain circumstances this was not occurring. The second 
change applies smoothing of the cell-to-well conductance as a cell dries. These changes 
may cause small changes to simulation results if these conditions arise (that is, cell 
drying or seepage face conditions).

Drain (DRN) Package

A check was added for drain altitudes set below the cell bottom. If this occurs, then
an error is printed to the List file and the model is stopped.

General Head Boundary (GHB) Package

A check was added for head boundaries set to altitudes below the cell bottom. If this occurs, then
an error is printed to the List file and the model is stopped.

River (RIV) Package

A check was added for river heads set to altitudes below the cell bottom. If this occurs, then
an error is printed to the List file and the model is stopped.

Link-MT3DMS (LMT) Package

Changes were made to the Link-MT3DMS file to accommodate the MNW2 fluxes. There was 
a bug in the previous version of this file caused by a conflict between MNW1 and MNW2
and the header for the MT3DMS FTL file did not include MNW2. This bug was causing
MT3DMS to read the FTL file incorrectly.

Source files that were modified include: lmt7_NWT.f, lmt7_NWT.inc, gwf2mnw27_NWT.f, gwf2sfr7_NWT.f 
gwfsfrmodule_NWT.f, NWT1_xmd.f, and  NWT1_xmdlib.f, MF_NWT.f, gwf2drn7_NWT.f, gwf2ghb7_NWT.f,
gwf2riv7_NWT.f

o Version 1.0.4 01/25/2012:

Multi-Node Well (MNW1) Package and the lmt7_NWT.f and lmt7_NWT.inc source files

The name of the data module for in MNW1 was changed from GWFMNWMODULE to GWFMNW1MODULE to discriminate
it from the module in the MNW2 package. This change was required because data used in the lmt7_NWT.f
and lmt7_NWT.inc were being confused with data in the MNW2 Package module. Both the lmt7_NWT.f and
lmt7_NWT.inc files were changed to reflect the new module name.

Streamflow-Routing Package

Modifications were made to allow for negative NSTRM values to be specified in the SFR2 input file.
In versions of SFR2 prior to the version released with MODFLOW-NWT 1.0.3, a negative value of NSTRM 
could be specified to simulate unsaturated flow beneath streams and for specifying streambed 
information by reach. However, SFR2 released with MODFLOW-NWT 1.0.3 was changed such that negative
values specified for NSTRM would cause an error and the program would stop. SFR2 release with
MODFLOW-NWT 1.0.4 supports both the key word option and a negative value for NSTRM. 

See the modified input instructions for SFR2 titled "Updated_SFR2_input_instructions_NWT.pdf"
in the "doc" directory of this release.

The SFR2 variable NUMSEG was added to the Module GWFSFRMODULE.

Source files that were modified include: lmt7_NWT.f, lmt7_NWT.inc, gwf2mnw17_NWT.f, gwf2sfr7_NWT.f 
and gwfsfrmodule_NWT.f

o Version 1.0.3 12/29/2011:

NWT Solver

The previous version of the NWT solver would take zero outer iterations if the convergence tolerances
were met during the first calculation of the residuals. However, this condition could result in a poor
solution for some nonlinear problems. At least one iteration is now required for all time steps. 
This change could affect convergence for some problems. 

There was a bug that was causing the red-black ordering scheme to fail (NWT solver input variable 
IREDSYS=1).Red-black ordering can help speed convergence for difficult problems. This change could 
affect convergence for some problems.

The header written by the NWT solver to the main Listing file was changed slightly. The header previously
titled "RMS," or if residual control is active "RMS1" and "RMS2," was changed to "L2-NORM," and "L2-NEW" 
and "L2-OLD," respectively. This change reflects the true definition of the residual terms because they
are calculated as the L2-NORM and not the root-mean-squared error (RMS error). This change does not 
affect simulation results.

A few small changes were made to initialize variables and remove unused variables. These changes likely 
would not affect simulation results.

Unsaturated-Zone Flow Package

A bug was found that was introduced to the UZF1 package after 1.0.1 MODFLOW-NWT release. This 
bug was causing UZF1 to incorrectly calculate unsaturated-zone ET, which results in much less ET
than solution prior to the 1.0.2 release. This change does effect solution results as
compared to the 1.0.2 version but not compared to 1.0.1 version.
 
Three new options were added to this package to allow specification of the residual water content 
(THTR), to provide the option of specifying initial water content (THTI) for simulations that 
begin with a steady-state recharge period, and to turn off calculation of surface leakage. 
These changes were made for the following reasons. 

THTR originally was calculated internally by the UZF Package on the basis of the difference between the 
saturated water content (THTS) and the specific yield (SY) of the aquifer receiving recharge (Niswonger 
and others, 2006). However, the ability to specify THTR can be useful for some applications in which the 
maximum storage in the unsaturated zone (THTS-THTR)is different than the instantaneous drainage from the 
aquifer (SY). For these cases, specifying THTR based on external calculations provides greater 
flexibility for parameterizing the unsaturated zone. The option to specify THTR is activated using the 
key word SPECIFYTHTR. This key word is input on line 1a of the revised UZF1 input file (see revised 
input instructions below). Values for THTR are input following the variable THTS (see below).

Originally, THTI was not specified for simulations that included both a steady-state and one or more 
transient stress periods. For this case, THTI was calculated internally by the code on the basis of the 
steady-state infiltration rate and the unsaturated-zone hydraulic properties (FINF, FKS, EPS, THTS, and 
THTR). However, in well-drained soils, the steady-state recharge rate corresponds to an initial water 
content that is too large for coarse sediments. Consequently, drainage from the unsaturated zone during 
the first transient stress period could result in an unrealistically large recharge rate. Additionally, 
the head dependency on recharge that does not occur during steady-state stress periods but that can 
occur during transient stress periods can cause a sudden increase in recharge during the transition 
between these stress periods. For these circumstances it is more realistic to specify the initial water 
content for the first transient stress period that follows a steady-state stress period. The option to 
specify THTI in simulations that include both steady-state and one or more transient stress periods is 
activated using the key word SPECIFYTHTI. This key word is input on line 1a of the UZF1 input file, and 
follows the key word SPECIFYTHTR if SPECIFYTHTR is specified. Values for THTI are input following 
variable THTR if it is input; otherwise, THTI follows THTS (see below). 

UZF1 simulates surface leakage in the uppermost active cell if groundwater head is greater
than the top of this cell. Surface leakage is a nonlinear boundary condition that can slow model  
convergence, and in some cases it is beneficial to inactive this boundary condition. Surface leakage  
is inactivated by the key word NOSURFLEAK that is specified on line 1a of the UZF1 input 
file. This key word is specified following the key word SPECIFYTHTI (if SPECIFYTHTI is specified). 
If the key word NOSURFLEAK is specified then water will not be removed from the uppermost active cell 
when groundwater head rises above the top of this cell. 

In addition to these new input options, the default value for SURFDEP was changed.  
In prior versions of UZF1, if the value for SURFDEP was specified as 0, it was reset
internally to 1.0. In this new version of UZF1, SURFDEP is reset to 1.0x10-6. This change 
could affect simulated results if the value of SURDFEP was specified as 0 in the input file.

Modified input instructions for the UZF1 input file for specifying optional key words

0. Data: [#Text]		(As in previous versions of the code)

1a. Data: [SPECIFYTHTR] [SPECIFYTHTI] [NOSURFLEAK]

SPECIFYTHTR 	key word for specifying optional input variable THTR. 
SPECIFYTHTI 	key word for specifying optional input variable THTI.
NOSURFLEAK 	key word for inactivating calculation of surface leakage.

Note that the keywords must be entered in the order shown. For example, if keywords SPECIFYTHTR and 
NOSURFLEAK are specified, then SPECIFYTHTR must precede NOSURFLEAK. Alternatively, if only SPECIFYTHTI  
is specified, then the other two keywords should not be specified.

1b. Data: NUZTOP IUZFOPT IRUNFLG IETFLG IUZFCB1 IUZFCB2 NTRAIL2 NSETS2 NUZGAG SURFDEP NUZTOP		
   (As in previous versions of the code)

Items 2-5:  As in previous versions of the code.

6a. Data:  THTS (NCOL, NROW) -- U2DREL
Refer to UZF1 documentation report (Niswonger and other, 2006) for definition of THTS.

6b. Data: [THTR (NCOL, NROW)] -- U2DREL
THTR 	An array of positive real values used to define the residual water content for each vertical 
column of cells in units of volume of water to total volume (L3L-3). THTR is the irreducible water 
content and the unsaturated water content cannot drain to water contents less than THTR. This variable 
is not included unless the key word SPECIFYTHTR is specified.

7. Data: [THTI (NCOL, NROW)] -- U2DREL
Refer to UZF1 documentation report (Niswonger and others, 2006) for definition of THTI. This variable is 
not included for simulations with a steady-state stress period unless the key word SPECIFYTHTI is 
specified.

Items 8-16: As in previous versions of the code.

Streamflow-Routing Package
 
Modifications were made to correct the effects of lakes inundating stream cells. Seepage in inundated 
stream cells was not being set to zero in the budget routine. This change could affect mass-balance 
errors for models that include lakes that grow and inundate stream cells.

Modifications were made to correct a bug that occurred when the specific yield specified in  the 
Block-Centered Flow (BCF7) Package was used for calculating the residual water content for the 
unsaturated zone beneath streams. Changes were made such that the code searches through model layers 
to find the corresponding layer that stores the specific yield for the case when the BCF7 input 
variable LAYCON is 2 or 3.

Modifications were made to add a smoothing function for the calculation of wetted channel area when the 
SFR2 input variable ICALC is set to 1 (constant stream width). In previous versions of the package, a 
discontinuity could form if the stream channel became dry during the outer iteration of a time step, 
because stream width would oscillate between the specified value and zero. To avoid such conditions, a 
smoothing function was used in SFR2 to smooth the transition between the constant (specified) stream 
width and a zero stream width over the interval between zero depth and 1.0x10-5 (units defined on the 
basis of the DIS file input variable LENUNI). Smoothing is applied automatically if ICALC=1 and the 
stream depth is between zero and 1.0x10-5 and users should refer to the calculated stream depths to 
determine if smoothing was applied to a particular reach in a simulation. SFR2 smooths the constant-
to-zero-width transition using the same smoothing function that is used by the WEL Package to decrease 
specified pumping rates to zero when unconfined cells are dry (see Niswonger and others, 2011, p. 14). 

Lake Package

A format statement was modified to allow proper printout of the number of dry lake cells to the main 
Listing file. This change does not affect simulation results.

Source files that were modified include: NWT1_solver.f,NWT1_xmd.f,gwf2uzf1_NWT.f,gwfuzfmodule_NWT.f,
gwf2sfr7_NWT.f,gwfsfrmodule_NWT.f,gwf2lak7_NWT.f, NWT1_module.f, NWT1_gmres.f90, MF_NWT.f, 
gwfsfrmodule_NWT.f, gwf2wel7_NWT.f, gwf2upw1.f, gwf2sub7.f, and gwf2hfb7_NWT.f.

o Version 1.0.2 10/03/2011:

MODFLOW-NWT was compiled again because the last release of the program required 
a large amount of RAM to run models. The reason for this unnecessary memory usage
was not determined but it is assumed that the issue was related to the compiler.
The new compiled version requires much less memory. For example, a model that
required 2 Gb of memory to run now requires 120 Mb. This new memory usage
is consistent with what is required by MODFLOW-2005.

Changes were made to the MODFLOW-NWT source files such that residual-control 
(backtracking) iterations are no longer counted as outer iterations. This change 
affects the NWT solver iteration information that is printed to the main List file. 

Another change was made to stop model execution when the convergence criteria are not met.
In previous versions of MODFLOW-NWT, the model continued to solve after the model
failed to converge. A keyword option was added to the NWT Package input file to 
allow the user to control whether the model will stop after convergence failure. 
If the keyword "CONTINUE" is added following the input variable OPTIONS then the model  
will not stop after convergence failure. If this keyword is not specified then the 
model will stop after convergence failure. For example, the key word "CONTINUE" can 
be added to the first line of the NWT input file as:

1.0E-4 1. 500 1.0e-5  2  1 1 SPECIFIED CONTINUE 0.9 0.00001 0.000  0.10 0  20 2.0 0.6

For this input option, if the model fails to converge during a time step then it 
will continue to the next time step. However, if the "CONTINUE" is removed
from this line, then the model will stop after convergence failure.

Another change was made to fix a bug that caused the model to print a blank line
to the main List file rather than correctly printing the string "SPECIFIC YIELD
FOR LAYER..." This change does not affect model results.

Another change was made to modify how groundwater heads are reset to the layer-
bottom altitude when the calculated heads are below the bottom of the deepest layer. 
In the previous version of the code there was a condition when heads could be 
reset to an incorrect value, and this caused small oscillations in some problems.   
This change may have a small affect to improve model convergence if the NWT input 
variable IBOTAV is equal to 1.

Another change was made to fix oscillatory behavior caused by a feature in the MNW2
and MNW1 packages. The original versions of these packages switched between
a specified flux and a head-dependent boundary conditions during outer iterations.
The MNW1 and MNW2 packages were modified such that the boundary condition is
fixed as a head-dependent boundary condition.

A small change was made in the XMD source file to allow for double precision
compilations. This change was to change the statement from real*4 to real. 

Small changes were made to the UZF1 and SFR2 source files to improve standard
output options.

Changes were made to the MT3DMS linker files (lmt7_NWT.f, and lmt7_NWT.inc) to
include water balance information for the MNW2 and MNW1 packages.

Source files that were modified include: MF_NWT.f, NWT1_solver.f, NWT1_xmd.f,     
gwf2MNW27_NWT.f, gwf2MNW17_NWT.f, gwf2sfr7_NWT.f, gwf2upw1.f, gwfsfrmodule_NWT.f, 
gwf2uzf1_NWT.f, gwfuzfmodule_NWT.f, lmt7_NWT.f, and lmt7_NWT.inc.

o Version 1.0.1 05/27/2011:

Changes were made to the MODFLOW-NWT source files to correct an error in how the
Horizontal-Flow (HFB) Barrier Package was implemented in MODFLOW-NWT. Additionally,
changes were made to deallocate arrays in the XMD and GMRES solvers at the termination 
of a simulation.

Source files that were modified include: MF_NWT.f, NWT1_solver.f, NWT1_xmd.f,     
gwf2hfb7_NWT.f, NWT1_gmres.f90, and gwf2bas7.f

o Version 1.0 05/11/2011:

This version is the initial release. However, a number of changes were required  
for four additional MODFLOW-2005 Packages that were not explained in the 
MODFLOW-NWT documentation report (Niswonger and others, 2011). The modified 
packages include the Horizontal-Flow Barrier, Lake, and Multi-Node Well Packages
versions 1 and 2.

Changes to the Horizontal-Flow (HFB) Barrier Package were made to the subroutine
GWF2HFB7FM. If the Newton method is used in MODFLOW-NWT, then horizontal
conductances do not include the aquifer thickness for unconfined conditions.
Thus, equations were changed such that the conductances modified in subroutine
GWF2HFB7FM are not multiplied by the aquifer thickness. This change required that
a new argument be added to the call statement for subroutine GWF2HFB7FM to include
the file unit number for the UPW Package.

Changes to the Lake (LAK) Package were made to the subroutine GWF2LAK7RP and a new 
subroutine was added to the LAK Package called SGWF2LAK7UPW1RPS for calculating
lakebed conductance values. This change required that a new argument be added to
the call statement for subroutine GWF2LAK7RP to include the file unit number for
the UPW Package.

Changes to Versions 1 and 2 of the multi-Node Well (MNW1 and MNW2) Packages were
made to the subroutines GWF2MNW17RP and GWF2MNW27RP. A new subroutine was added to
the MNW1 and MNW2 Packages called CEL2WELUPW for calculating well conductance
values. A new argument was added to the call statement for subroutines GWF2MNW17RP
and GWF2MNW27RP to include the file unit number for the UPW Package.

References

Anderman, E. R., & Hill, M. C. (2000). MODFLOW-2000: The US Geological Survey Modular Ground-water
Model--documentation of the Hydrogeologic-Unit Flow (HUF) Package. US Department of the Interior,
US Geological Survey. Available online at http://pubs.er.usgs.gov/publication/ofr03347

Bakker, Mark, Schaars, Frans, Hughes, J.D., Langevin, C.D., and Dausman, A.M., 2013, 
Documentation of the seawater intrusion (SWI2) package for MODFLOW: U.S. Geological Survey 
Techniques and Methods, book 6, chap. A46, 47 p. Available online at http://pubs.er.usgs.gov/publication/tm6A46

Bedekar, V., Morway, E.D., Langevin, C.D., Tonkin, M.T., 2016, MT3D-USGS Version 1: A U.S. Geological Survey 
Release of MT3DMS Updated with New and Expanded Transport Capabilities for MODFLOW, U.S. Geological Survey, 
Techniques and Methods 6-A53 variously p. 

Hughes, J.D., Langevin, C.D., Chartier, K.L., and White, J.T., 2012, Documentation of the Surface-Water 
Routing (SWR1) Process for modeling surface-water flow with the U.S. Geological Survey Modular Ground-Water 
Model (MODFLOW-2005): U.S. Geological Survey Techniques and Methods, book 6, chap. A40 (Version 1.0), 113 p. 
Available online at http://pubs.er.usgs.gov/publication/tm6A40

Konikow, L.F., Hornberger, G.Z., Halford, K.J., and Hanson, R.T., 2009, Revised multi-node well 
(MNW2) package for MODFLOW ground-water flow model: U.S. Geological Survey Techniques and Methods 
6–A30, 67 p. Available online at http://pubs.er.usgs.gov/publication/tm6A30

Niswonger, R.G., Panday, Sorab, and Ibaraki, Motomu, 2011, MODFLOW-NWT, A Newton formulation for 
MODFLOW-2005: U.S. Geological Survey Techniques and Methods 6-A37, 44 p.
Available online at http://pubs.er.usgs.gov/publication/tm6A37

Niswonger, R.G., Prudic, D.E., and Regan, R.S., 2006, Documentation of the Unsaturated-Zone Flow (UZF1) 
Package for modeling unsaturated flow between the land surface and the water table with MODFLOW-2005: 
U.S. Geological Survey Techniques and Methods 6-A19, 62 p.  
Available online at http://pubs.er.usgs.gov/publication/tm6A19    

Niswonger, R. G. (2020). An Agricultural Water Use Package for MODFLOW and GSFLOW. Environmental Modelling & Software, 104617.
https://www.sciencedirect.com/science/article/pii/S1364815219305080                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            